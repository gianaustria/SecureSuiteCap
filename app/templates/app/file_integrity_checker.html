{% extends 'app/layout.html' %}
{% load static form_tags %}

{% block content %}
<div class="container mt-5 max-w-5xl">
    <div class="bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">File Integrity Checker</h2>
        <ul class="nav nav-tabs mb-4 border-b-2 border-gray-200">
            <li class="nav-item">
                <a class="nav-link active bg-blue-100 text-blue-600 font-semibold px-4 py-2 rounded-t-md" data-section="upload" href="#">Upload</a>
            </li>
            <li class="nav-item">
                <a class="nav-link bg-white text-gray-700 px-4 py-2 rounded-t-md" data-section="logs" href="#">Logs</a>
            </li>
            <li class="nav-item">
                <a class="nav-link bg-white text-gray-700 px-4 py-2 rounded-t-md" data-section="visualization" href="#">Visualizations</a>
            </li>
            <li class="nav-item">
                <a class="nav-link bg-white text-gray-700 px-4 py-2 rounded-t-md" data-section="collaboration" href="#">Collaboration</a>
            </li>
            <li class="nav-item">
                <a class="nav-link bg-white text-gray-700 px-4 py-2 rounded-t-md" data-section="policies" href="#">Policies</a>
            </li>
        </ul>

        <div id="upload" class="section block">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Upload Files</h3>
            <form id="uploadForm" enctype="multipart/form-data" class="space-y-4">
                {% csrf_token %}
                <input type="file" name="files" multiple class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button type="submit" class="bg-blue-600 text-white py-2 px-6 rounded-md hover:bg-blue-700">Upload</button>
            </form>
            <div id="results" class="mt-4 space-y-4"></div>
        </div>

        <div id="logs" class="section hidden">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Logs</h3>
            <a href="{% url 'download_logs' %}" class="inline-block bg-blue-600 text-white py-2 px-6 rounded-md hover:bg-blue-700 mb-4">Download Logs (CSV)</a>
            <div id="logsList" class="space-y-4">
                {% for log in logs %}
                <div class="border border-gray-200 p-4 rounded-lg">
                    <p><strong>File:</strong> {{ log.filename }}</p>
                    <p><strong>Status:</strong> {{ log.status }}</p>
                    <p><strong>User:</strong> {{ log.user.username|default:"Anonymous" }}</p>
                    <p><strong>Created:</strong> {{ log.created_at|date:"Y-m-d H:i:s" }}</p>
                    <p><strong>Stats:</strong> {{ log.stats }}</p>
                </div>
                {% empty %}
                <p class="text-gray-600">No logs available.</p>
                {% endfor %}
            </div>
        </div>

        <div id="visualization" class="section hidden">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Visualizations</h3>
            <div id="visualizationData"
                 data-malicious="{{ malicious_count|default:0 }}"
                 data-non-malicious="{{ non_malicious_count|default:0 }}">
                <p class="text-gray-600">Malicious Files: {{ malicious_count }}</p>
                <p class="text-gray-600">Non-Malicious Files: {{ non_malicious_count }}</p>
            </div>
            <canvas id="visualizationChart" class="mt-4 max-w-full"></canvas>
        </div>

        <div id="collaboration" class="section hidden">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Collaboration</h3>
            <form id="collabForm" class="space-y-4">
                <textarea name="message" class="w-full border-2 border-gray-300 rounded-lg p-2" rows="4" placeholder="Enter your message"></textarea>
                <button type="submit" class="bg-blue-600 text-white py-2 px-6 rounded-md hover:bg-blue-700">Post Message</button>
            </form>
            <div id="collabList" class="space-y-4"></div>
        </div>

        <div id="policies" class="section hidden">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Policies</h3>
            <form id="policiesForm" class="space-y-4"></form>
        </div>

    </div>
</div>

<style>
    .nav-tabs {
        border-bottom: 2px solid #e5e7eb;
    }
    .nav-link {
        padding: 10px 20px;
        border-radius: 6px 6px 0 0;
        cursor: pointer;
    }
    .nav-link.active {
        font-weight: 600;
    }
    .section {
        display: none;
    }
    .section.block {
        display: block;
    }
</style>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="{% static 'app/scripts/jquery.validate.min.js' %}"></script>
<script src="{% static 'app/scripts/script.js' %}"></script>
{% endblock %}