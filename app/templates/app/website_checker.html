{% extends 'app/layout.html' %}
{% block content %}
<div class="container mt-5">
    <div class="card shadow-sm">
        <div class="card-body">
            <h2 class="card-title mb-4 text-primary">Website Security Checker</h2>

            <div class="mb-4">
                <label for="url" class="form-label fw-bold">Target URL</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="url" placeholder="example.com" aria-describedby="urlHelp">
                    <button class="btn btn-primary" onclick="checkAvailability()">Check Availability</button>
                </div>
                <div id="urlHelp" class="form-text">Enter a valid website URL (e.g., example.com)</div>
                <span id="checkResult" class="text-danger mt-2 d-block"></span>
            </div>

            <div class="row g-4">
                <div class="col-md-6">
                    <h5 class="mb-3">Homepage Test</h5>
                    <button class="btn btn-outline-secondary w-100 mb-2" onclick="runHomepageTest()">Run Test</button>
                    <textarea class="form-control" id="homepageOutput" rows="6" readonly></textarea>
                </div>

                <div class="col-md-6">
                    <h5 class="mb-3">Ping Test</h5>
                    <button class="btn btn-outline-secondary w-100 mb-2" onclick="runPingTest()">Run Test</button>
                    <textarea class="form-control" id="pingOutput" rows="6" readonly></textarea>
                </div>

                <div class="col-md-6">
                    <h5 class="mb-3">Traceroute Test</h5>
                    <button class="btn btn-outline-secondary w-100 mb-2" onclick="runTracerouteTest()">Run Test</button>
                    <textarea class="form-control" id="tracerouteOutput" rows="6" readonly></textarea>
                </div>

                <div class="col-md-6">
                    <h5 class="mb-3">DNS Security Check</h5>
                    <button class="btn btn-outline-secondary w-100 mb-2" onclick="runDnsCheck()">Run Test</button>
                    <textarea class="form-control" id="dnsOutput" rows="6" readonly></textarea>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .container {
        max-width: 1200px;
    }

    .card {
        border-radius: 10px;
        border: none;
    }

    .card-title {
        font-size: 1.8rem;
        font-weight: 600;
    }

    .form-control {
        border-radius: 6px;
    }

    .btn {
        border-radius: 6px;
        padding: 8px 20px;
    }

    .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
    }

    .btn-outline-secondary {
        border-color: #6c757d;
    }

        .btn-outline-secondary:hover {
            background-color: #6c757d;
            color: white;
        }

    textarea.form-control {
        background-color: #f8f9fa;
        resize: none;
    }

    .text-danger {
        font-size: 0.9rem;
    }
</style>

{% endblock %}

{% block scripts %}
<script>
    // Get CSRF token for AJAX POST requests
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Check Availability function
    async function checkAvailability() {
        const urlInput = document.getElementById('url').value;
        const resultElement = document.getElementById('checkResult');

        if (!urlInput) {
            resultElement.textContent = 'Error: Please enter a URL';
            return;
        }

        try {
            const response = await fetch('/check/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ url: urlInput })
            });
            const data = await response.json();
            resultElement.textContent = data.result;
            resultElement.className = data.result.includes('Error') ? 'text-danger mt-2 d-block' : 'text-success mt-2 d-block';
        } catch (error) {
            resultElement.textContent = `Error: ${error.message}`;
            resultElement.className = 'text-danger mt-2 d-block';
        }
    }

    // Homepage Test function
    async function runHomepageTest() {
        const urlInput = document.getElementById('url').value;
        const outputElement = document.getElementById('homepageOutput');

        if (!urlInput) {
            outputElement.value = 'Error: Please enter a URL';
            return;
        }

        try {
            const response = await fetch('/homepage/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ url: urlInput })
            });
            const data = await response.json();
            outputElement.value = data.result;
        } catch (error) {
            outputElement.value = `Error: ${error.message}`;
        }
    }

    // Ping Test function
    async function runPingTest() {
        const urlInput = document.getElementById('url').value;
        const outputElement = document.getElementById('pingOutput');

        if (!urlInput) {
            outputElement.value = 'Error: Please enter a URL';
            return;
        }

        try {
            const response = await fetch('/ping/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ url: urlInput })
            });
            const data = await response.json();
            outputElement.value = data.result;
        } catch (error) {
            outputElement.value = `Error: ${error.message}`;
        }
    }

    // Traceroute Test function
    async function runTracerouteTest() {
        const urlInput = document.getElementById('url').value;
        const outputElement = document.getElementById('tracerouteOutput');

        if (!urlInput) {
            outputElement.value = 'Error: Please enter a URL';
            return;
        }

        try {
            const response = await fetch('/traceroute/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ url: urlInput })
            });
            const data = await response.json();
            outputElement.value = data.result;
        } catch (error) {
            outputElement.value = `Error: ${error.message}`;
        }
    }

    // DNS Security Check function
    async function runDnsCheck() {
        const urlInput = document.getElementById('url').value;
        const outputElement = document.getElementById('dnsOutput');

        if (!urlInput) {
            outputElement.value = 'Error: Please enter a URL';
            return;
        }

        try {
            const response = await fetch('/dns/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ url: urlInput })
            });
            const data = await response.json();
            outputElement.value = data.result;
        } catch (error) {
            outputElement.value = `Error: ${error.message}`;
        }
    }
</script>
{% endblock %}